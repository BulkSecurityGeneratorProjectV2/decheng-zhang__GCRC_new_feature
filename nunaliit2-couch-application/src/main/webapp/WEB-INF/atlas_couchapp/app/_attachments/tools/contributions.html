<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
		<title>Contributions</title>		
		<link rel="stylesheet" href="../js-external/css/jquery-ui/smoothness/jquery-ui.custom.css" type="text/css" />
		<link rel="stylesheet" href="../js-external/OpenLayers/theme/default/style.css" type="text/css" />
		<link rel="stylesheet" href="../js-external/css/jquery.lightbox-0.5.css" type="text/css" />
		<link rel="stylesheet" href="../nunaliit2/jquery-progress-1.0.css" type="text/css" />
		<link rel="stylesheet" href="../nunaliit2/jquery-progress-slide-1.0.css" type="text/css" />
		<link rel="stylesheet" href="../nunaliit2/olkit_atlas.css" type="text/css" />
		<link rel="stylesheet" href="../nunaliit2/css/basic/nunaliit2.css" type="text/css" />
	</head>
	<body>
		<div id="contribution_selection"></div>
		
		<script type="text/javascript" src="../js-external/js/jquery.min.js"></script>
		<script type="text/javascript" src="../js-external/js/jquery-ui.min.js"></script>
		
		<script src="http://maps.google.com/maps/api/js?v=3.3&sensor=false"></script>
		
		<script type="text/javascript" src="../js-external/OpenLayers/OpenLayers.js"></script>
		<script type="text/javascript" src="../js-external/js/jquery.lightbox-0.5.js"></script>
		
		<script type="text/javascript" src="../js-external/js/jquery.cycle.pack.js"></script>
		<script type="text/javascript" src="../js-external/js/jquery.form.2.49.js"></script>
		<script type="text/javascript" src="../js-external/js/jquery.cookie-1.0.js"></script>

		<script type="text/javascript" src="../lib/atlas.js"></script>
		<script type="text/javascript" src="../nunaliit2/nunaliit2-debug.js"></script>
		<script type="text/javascript" src="../nunaliit2/n2.couch.js"></script>
		<script type="text/javascript" src="../nunaliit2/n2.couchGeom.js"></script>
		<script type="text/javascript" src="../nunaliit2/n2.couchEdit.js"></script>
		<script type="text/javascript" src="../nunaliit2/n2.couchDisplay.js"></script>
		<script type="text/javascript" src="../nunaliit2/n2.couchSearch.js"></script>
		<script type="text/javascript" src="../nunaliit2/n2.couchContribution.js"></script>
		<script type="text/javascript" src="../nunaliit2/n2.couch.ol.js"></script>
		<script type="text/javascript" src="../nunaliit2/n2.couch.l10n.js"></script>
		<script type="text/javascript" src="../nunaliit2/n2.form.js"></script>
		<script type="text/javascript" src="../nunaliit2/n2.tree.js"></script>

		<script type="text/javascript">
			// <!--

			var atlasDb = null;
			var atlasDesign = null;
			var contMgr = null;
			
			function main_init() {
				atlasDb = $n2.couch.getDb({dbName:'atlas'});
				atlasDesign = atlasDb.getDesignDoc({ddName:'atlas'});

				contMgr = new $n2.couchContributions({
					db: atlasDb
					,designDoc: atlasDesign
				});
				
				contMgr.searchContributions({
					elem: $('#contribution_selection')
					,uploadType: 'image'
					,onSuccess: function(doc){
						log('selected',doc);
					}
				});
			};

			var loaded = false;			
			function waitForComponentsLoaded() {
				if( loaded ) return;
				
				if( nunaliit2.upload
				 && nunaliit2.couch
				 ) {
				 	$n2 = window.nunaliit2;
				 	
				 	// Turn off cometd
				 	$.cometd = {
				 		init: function(){}
				 		,subscribe: function(){}
				 		,publish: function(){}
				 	};
				 	
				 	$n2.couch.initialize({
				    	pathToDocs: '../../../'
				    	,pathToServer: '../../../../'
				    	,onSuccess: function() {
							$.NUNALIIT_AUTH.init({
								onSuccess: main_init
								,autoAnonymousLogin: false
							});
				    	}
				 	});
					
					loaded = true;
				} else {
					setTimeout(waitForComponentsLoaded, 100);
				};
			};
			
			jQuery().ready(function() {
				waitForComponentsLoaded();
			});
			// -->
		</script>
	</body>
</html>
