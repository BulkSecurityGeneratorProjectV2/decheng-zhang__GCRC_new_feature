<!DOCTYPE html>
<html>
  <head>
    <title>Bulk Documents</title>
    <link rel="stylesheet" href="../js-external/css/jquery-ui/smoothness/jquery-ui.custom.css" type="text/css">
  </head>
  <body>
    <h1>Bulk Documents</h1>

	<textarea id="insert_ta" style="width:100%; height:25%;"></textarea>
	<br/>
	<input id="insert_button" type="button" value="Insert/Update"/>
	
  </body>
  <script src="../js-external/js/jquery.min.js"></script>
  <script src="../js-external/js/jquery-ui.min.js"></script>
  <script src="../js-external/js/jquery.form.2.49.js"></script>
  <script src="../js-external/OpenLayers/OpenLayers.js"></script>
  <script src="../js-external/js/sha1.js"></script>
  <script src="../nunaliit2/cometd/json2.js"></script>
  <script type="text/javascript" src="../lib/atlas.js"></script>
  <script src="../nunaliit2/nunaliit2-debug.js"></script>
  <script src="../nunaliit2/n2.couch.js"></script>
  <script src="../nunaliit2/n2.couchGeom.js"></script>
  <script src="../nunaliit2/n2.form.js"></script>
  <script src="../lib/tiles.js"></script>
  <script type="text/javascript">

   	var g_session;
    var g_userDb;
   	var g_atlasDb;
    var g_atlasDesign;

	function main() {
		$('#insert_button').click(function(){
			var ta = $('#insert_ta').val();
			var arr = eval('[' + ta + ']');
			g_atlasDb.bulkDocuments(arr,{
				onSuccess: function(result) {
					$n2.log('Bulk Document response',result);
					alert('Bulk operation completed!');
				}
			});
		});
	};
    
    function initAuth() {
		$.NUNALIIT_AUTH.init({
			onSuccess: main
			,autoAnonymousLogin: false
		});
    };
	
    $n2.couch.initialize({
    	pathToServer: '../../../../'
    	,onSuccess: function() {
	    	g_session = $n2.couch.getSession();
		    g_userDb = $n2.couch.getUserDb();
	    	g_atlasDb = $n2.couch.getDb({dbName:'atlas'});
		    g_atlasDesign = g_atlasDb.getDesignDoc({ddName:'atlas'});
		    
		    initAuth();
    	}
    });
	

  </script>
</html>
